(window.webpackJsonp=window.webpackJsonp||[]).push([[69,54],{437:function(e,t,n){"use strict";var r=n(3),o=(n(20),{methods:{setErrors:function(e,t){var n=this;return Object(r.a)(regeneratorRuntime.mark((function r(){var o,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:for(c in o={},e)o[c]=[n.$t("back_error.".concat(e[c]))];return r.next=4,n.$refs[t].setErrors(o);case 4:n.scrollToError();case 5:case"end":return r.stop()}}),r)})))()},scrollToError:function(){var e=document.querySelector(".validate-error");e&&e.scrollIntoView({behavior:"smooth",block:"center"})}}}),c=n(5),component=Object(c.a)(o,undefined,undefined,!1,null,null,null);t.a=component.exports},439:function(e,t,n){var content=n(450);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(49).default)("0ef93fc6",content,!0,{sourceMap:!1})},448:function(e,t,n){"use strict";var r={mixins:[n(92).a],props:{actionUrl:{type:String,required:!0},paymentFields:{type:Object,required:!0},name:{type:String,default:"gate".concat(Date.now())}},data:function(){return{visible:!1}},methods:{openModal:function(){this.scrollLock(),this.visible=!0},closeModal:function(e){this.$socket.unsubscribe("platon-channel-".concat(e)),this.cancelScrollLocks(),this.visible=!1},submitForm:function(){this.$refs.form.submit()}}},o=(n(449),n(5)),component=Object(o.a)(r,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.visible?n("div",{staticClass:"dt-payment-modal"},[n("form",{ref:"form",staticClass:"dt-payment-modal__form",attrs:{action:e.actionUrl,method:"POST",target:e.name}},e._l(e.paymentFields,(function(t,r){return n("input",{directives:[{name:"model",rawName:"v-model",value:e.paymentFields[r],expression:"paymentFields[key]"}],key:r,attrs:{name:r,type:"hidden"},domProps:{value:e.paymentFields[r]},on:{input:function(t){t.target.composing||e.$set(e.paymentFields,r,t.target.value)}}})})),0),e._v(" "),n("div",{staticClass:"dt-payment-modal__container"},[n("div",{staticClass:"dt-payment-modal__content-block"},[n("div",{staticClass:"dt-popup-button-close",attrs:{"data-test":"palaton-close"},on:{click:function(t){return e.closeModal(e.paymentFields.order)}}}),e._v(" "),n("div",{staticClass:"dt-payment-modal__platon-container"},[n("iframe",{class:"dt-payment-modal__platon-iframe",attrs:{src:"",height:"410",name:e.name,frameborder:"0"}})])])])]):e._e()}),[],!1,null,null,null);t.a=component.exports},449:function(e,t,n){"use strict";n(439)},450:function(e,t,n){var r=n(48)(!1);r.push([e.i,'.dt-payment-modal{top:0;left:0;width:100%;height:100%;z-index:10001;position:fixed}.dt-payment-modal .dt-popup-button-close{top:10px;right:10px}.dt-payment-modal:after{right:-15px;width:15px;height:100%;content:"";display:block;position:absolute;background-color:rgba(0,0,0,.5)}.dt-payment-modal__container{top:0;left:0;width:100%;height:100%;display:flex;z-index:100;position:absolute;align-items:center;justify-content:center;background:rgba(0,0,0,.5)}.dt-payment-modal__content-block{width:100%;height:90vh;z-index:5;padding:40px 10px 0;position:relative;overflow:auto;max-height:666px;max-width:510px;background:#fff;border-radius:10px}.dt-payment-modal__platon-container{height:100%;overflow:auto}.dt-payment-modal__platon-iframe{width:100%;height:99%;margin:0;padding:0;overflow:auto}@media (max-width:900px){.dt-payment-modal:after{content:none}}@media (max-width:500px){.dt-payment-modal__content-block{padding:20px 0 0;max-width:100%;max-height:440px;margin-left:20px;margin-right:20px}}',""]),e.exports=r},602:function(e,t,n){var content=n(775);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(49).default)("2c0c7f1c",content,!0,{sourceMap:!1})},774:function(e,t,n){"use strict";n(602)},775:function(e,t,n){var r=n(48)(!1);r.push([e.i,'.phone-change{padding:15px 20px 20px;max-width:340px;line-height:20px;margin-left:auto;margin-right:auto}.phone-change h1{margin:0 auto 20px;font-size:22px;font-weight:400;text-align:center;text-transform:uppercase}@media (min-width:1201px){.phone-change h1{font-weight:600;margin-bottom:20px;text-transform:none}}.phone-change__container{font-size:14px}.phone-change__container .dt-input-block{position:relative;margin-bottom:20px}.phone-change__container .dt-input-block__label{display:none;font-size:16px}@media (min-width:1201px){.phone-change__container .dt-input-block__label{left:-150px;height:40px;display:flex;position:absolute;align-items:center}}.phone-change__error{color:#fff;padding:5px;display:flex;margin-top:-15px;background:#dd4a37;line-height:1.2;align-items:center;font-weight:400;margin-bottom:20px;border-radius:5px}.phone-change__error:before{content:"!";font-size:40px;padding-right:6px}.phone-change__secret-word-helper{margin:-1.25em 0 1.25em;display:block;font-size:12px}.phone-change__card-list{margin-bottom:20px}.phone-change__card-list__item{display:block}@media (min-width:1201px){.phone-change__cant-change{margin:0 -55%}}.phone-change__cant-change__img{margin:0 auto 20px;display:block}.phone-change__cant-change__txt{display:block;margin-bottom:20px}.phone-change__submit-btn{width:268px;height:50px;margin:20px auto 0}@media (min-width:1201px){.phone-change__submit-btn{margin-left:0}}',""]),e.exports=r},850:function(e,t,n){"use strict";n.r(t);var r=n(3),o=(n(20),n(32),n(50),n(18),n(91),n(93)),c=n(152),h=n(153),l=n(448),d=n(157),_=n(151),m=n(437),v={head:function(){return{title:"".concat(this.$t("titles.general")," ").concat(this.$t("phone_change.title"))}},data:function(){return{email:"",password:"",secretWord:"",errorMessage:"",secretWordHelper:"",newPhone:"+380 (",currentPhone:"+380 (",cardList:[],isShowPreload:!1,isShowPaymentModal:!1,isAuthenticationWithPhone:!0,isPhoneChangeWithSecretWord:!0,paymentOrder:"",paymentRequestUrl:"",paymentFormParams:{},activeStageNumber:0,STAGES:{authentication:0,chooseMethod:1,changeWitchSecretWord:2,changeWitchCard:3,cantChangePhone:4,wrongCardNumber:5}}},computed:{submitBtnTxt:function(){switch(this.activeStageNumber){case this.STAGES.authentication:case this.STAGES.chooseMethod:return this.$t("general.modal_button");case this.STAGES.changeWitchSecretWord:return this.$t("phone_change.new_phone.secret_word.btn");case this.STAGES.changeWitchCard:case this.STAGES.wrongCardNumber:return this.$t("phone_change.new_phone.card.btn")}},helpTitleTxtHTML:function(){switch(this.activeStageNumber){case this.STAGES.authentication:return"<span>".concat(this.$t("phone_change.authentication_txt"),"</span>");case this.STAGES.chooseMethod:return"<span>".concat(this.$t("phone_change.choose_method.txt"),"</span>");case this.STAGES.changeWitchSecretWord:return"<span>\n                    ".concat(this.$t("phone_change.new_phone.secret_word.title.first"),"\n                    <b>").concat(this.$t("phone_change.new_phone.new_phone_number"),"</b>\n                    ").concat(this.$t("phone_change.new_phone.secret_word.title.last"),"\n                  </span>");case this.STAGES.changeWitchCard:return"<span>\n                    ".concat(this.$t("phone_change.new_phone.card.title"),"\n                    <b>").concat(this.$t("phone_change.new_phone.new_phone_number"),"</b>\n                  </span>")}},isCantChangePhoneNumber:function(){return this.isNeedFinishRegistration||this.activeStageNumber===this.STAGES.wrongCardNumber},isNeedFinishRegistration:function(){return this.activeStageNumber===this.STAGES.cantChangePhone}},methods:{onAuthenticationMethodSwitch:function(e){this.hideErrorMessage(),this.isAuthenticationWithPhone=e},onPhoneChangeMethodSwitch:function(e){this.hideErrorMessage(),this.isPhoneChangeWithSecretWord=e},onSubmit:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.isShowPreload=!0,e.hideErrorMessage(),t.t0=e.activeStageNumber,t.next=t.t0===e.STAGES.authentication?5:t.t0===e.STAGES.chooseMethod?11:t.t0===e.STAGES.changeWitchSecretWord?14:t.t0===e.STAGES.changeWitchCard?20:t.t0===e.STAGES.wrongCardNumber?26:28;break;case 5:return t.next=7,e.$refs.authorization.validate();case 7:if(!t.sent){t.next=10;break}return t.next=10,e.$axios.$post("/login_check",{username:e.email||e.currentPhone.replace(/\D/g,""),password:e.password,is_phone_change:!0}).then((function(t){e.$axios.$get("/phone-number-change/user-data").then((function(t){if(t.data.secret_word_category&&t.data.card_list)return e.activeStageNumber=e.STAGES.chooseMethod,e.cardList=t.data.card_list,void(e.secretWordHelper=t.data.secret_word_category);e.activeStageNumber=e.STAGES.cantChangePhone,t.data.secret_word_category&&(e.activeStageNumber=e.STAGES.changeWitchSecretWord,e.secretWordHelper=t.data.secret_word_category),t.data.card_list&&(e.activeStageNumber=e.STAGES.changeWitchCard,e.cardList=t.data.card_list)}))})).catch((function(t){switch(+t.response.status){case 401:e.errorMessage=e.$t("login.wrong_data")}}));case 10:return t.abrupt("break",28);case 11:return e.activeStageNumber=e.isPhoneChangeWithSecretWord?e.STAGES.changeWitchSecretWord:e.STAGES.changeWitchCard,e.isShowPreload=!1,t.abrupt("break",28);case 14:return t.next=16,e.$refs.change_witch_secret_word.validate();case 16:if(!t.sent){t.next=19;break}return t.next=19,e.$axios.$post("/phone-number-change/user-secret-word/verify-confirm",{phone:e.newPhone.replace(/\D/g,""),secret_word:e.secretWord}).then((function(t){e.$auth.setToken("local","Bearer ".concat(t.data.token)),e.$axios.setToken(t.data.token,"Bearer"),e.$auth.fetchUser(),location.href=e.localePath("cabinet")})).catch((function(t){422==+t.response.status&&(e.errorMessage=e.$t("back_error.".concat(t.response.data.message)))}));case 19:return t.abrupt("break",28);case 20:return t.next=22,e.$refs.change_witch_card.validate();case 22:if(!t.sent){t.next=25;break}return t.next=25,e.$axios.$post("/phone-number-change/card/verify",{phone:e.newPhone.replace(/\D/g,"")}).then((function(t){e.paymentFormParams=t.formFields,e.paymentRequestUrl=t.requestUrl,e.paymentOrder=e.paymentFormParams.order,e.$refs.payment_modal.openModal(),setTimeout((function(){e.$refs.payment_modal.submitForm()}),500),e.$socket.subscribe("phone-change-".concat(e.paymentOrder,"-").concat(e.$store.state.envType)).bind("card_verified",e.paymentCallBack)})).catch((function(t){422==+t.response.status&&(e.errorMessage=e.$t("back_error.".concat(t.response.data.message)))}));case 25:return t.abrupt("break",28);case 26:return e.activeStageNumber=e.STAGES.changeWitchCard,t.abrupt("break",28);case 28:e.isShowPreload=!1;case 29:case"end":return t.stop()}}),t)})))()},paymentCallBack:function(data){var e=this;this.$emit("setPreloader",!0),this.$refs.payment_modal.closeModal(this.paymentOrder),"success"!==data.status?this.activeStageNumber=this.STAGES.wrongCardNumber:this.$axios.$post("/phone-number-change/card/confirm",{phone:this.newPhone.replace(/\D/g,"")}).then((function(t){e.$auth.setToken("local","Bearer ".concat(t.data.token)),e.$axios.setToken(t.data.token,"Bearer"),e.$auth.fetchUser(),location.href=e.localePath("cabinet")}))},hideErrorMessage:function(){this.errorMessage=""}},components:{TextInput:c.a,Preloader:o.a,PhoneInput:h.a,PaymentModal:l.a,PasswordInput:d.a,ValidationError:_.a},mixins:[m.a],nuxtI18n:{paths:{ru:"/smena-nomera-telefona",ua:"/zmina-nomera-telefonu"}}},f=(n(774),n(5)),component=Object(f.a)(v,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"phone-change"},[n("transition",{attrs:{name:"fade"}},[e.isShowPreload?n("Preloader"):e._e()],1),e._v(" "),n("h1",[e._v(e._s(e.$t("phone_change.title")))]),e._v(" "),n("div",{staticClass:"phone-change__container"},[n("p",{domProps:{innerHTML:e._s(e.helpTitleTxtHTML)}}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.activeStageNumber===e.STAGES.authentication,expression:"activeStageNumber === STAGES.authentication"}]},[n("div",{staticClass:"method-switcher"},[n("p",{staticClass:"dt-input-block__label"},[e._v(e._s(e.$t("login.select_label")))]),e._v(" "),n("button",{staticClass:"method-switcher__item",class:{"method-switcher__item--is-active":e.isAuthenticationWithPhone},attrs:{type:"button"},on:{click:function(t){return t.stopPropagation(),e.onAuthenticationMethodSwitch(!0)}}},[e._v("\n          "+e._s(e.$t("login.authorization_phone"))+"\n        ")]),e._v(" "),n("button",{staticClass:"method-switcher__item",class:{"method-switcher__item--is-active":!e.isAuthenticationWithPhone},attrs:{type:"button"},on:{click:function(t){return t.stopPropagation(),e.onAuthenticationMethodSwitch(!1)}}},[e._v("\n          E-mail\n        ")])]),e._v(" "),n("ValidationObserver",{ref:"authorization"},[e.isAuthenticationWithPhone?n("ValidationProvider",{attrs:{vid:"currentPhone",name:e.$t("validator.phone"),rules:{required:!0,regex:/^\+380\s\([0-9]{2}\)\s[0-9]{3}\-[0-9]{2}\-[0-9]{2}$/}},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.errors;return[n("PhoneInput",{class:{"validate-error":r.length},attrs:{value:e.currentPhone,label:e.$t("login.phone_label")},on:{focus:e.hideErrorMessage},model:{value:e.currentPhone,callback:function(t){e.currentPhone=t},expression:"currentPhone"}},[r.length?n("ValidationError",{attrs:{message:r[0]}}):e._e()],1)]}}],null,!1,3341749877)}):n("ValidationProvider",{attrs:{vid:"email",name:"Email",rules:"email"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.errors;return[n("TextInput",{class:{"validate-error":r.length},attrs:{value:e.email,placeholder:"Email",label:"E-mail"},on:{focus:e.hideErrorMessage},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}},[r.length?n("ValidationError",{attrs:{message:r[0]}}):e._e()],1)]}}])}),e._v(" "),n("ValidationProvider",{attrs:{vid:"password",name:e.$t("validator.password"),rules:"required"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.errors;return[n("PasswordInput",{class:{"validate-error":r.length>0},attrs:{value:e.password,placeholder:e.$t("login.password_label"),label:e.$t("login.password_label")},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}},[r.length>0?n("ValidationError",{attrs:{message:r[0]}}):e._e()],1)]}}])})],1)],1),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.activeStageNumber===e.STAGES.chooseMethod,expression:"activeStageNumber === STAGES.chooseMethod"}]},[n("div",{staticClass:"method-switcher"},[n("p",{staticClass:"dt-input-block__label"},[e._v(e._s(e.$t("login.select_label")))]),e._v(" "),n("button",{staticClass:"method-switcher__item",class:{"method-switcher__item--is-active":e.isPhoneChangeWithSecretWord},attrs:{type:"button"},on:{click:function(t){return t.stopPropagation(),e.onPhoneChangeMethodSwitch(!0)}}},[e._v("\n          "+e._s(e.$t("phone_change.choose_method.methods.secret_word"))+"\n        ")]),e._v(" "),n("button",{staticClass:"method-switcher__item",class:{"method-switcher__item--is-active":!e.isPhoneChangeWithSecretWord},attrs:{type:"button"},on:{click:function(t){return t.stopPropagation(),e.onPhoneChangeMethodSwitch(!1)}}},[e._v("\n          "+e._s(e.$t("phone_change.choose_method.methods.card"))+"\n        ")])])]),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.activeStageNumber===e.STAGES.changeWitchSecretWord,expression:"activeStageNumber === STAGES.changeWitchSecretWord"}]},[n("ValidationObserver",{ref:"change_witch_secret_word"},[n("ValidationProvider",{attrs:{vid:"changeWitchSecretWord_newPhone",name:e.$t("validator.phone"),rules:{required:!0,regex:/^\+380\s\([0-9]{2}\)\s[0-9]{3}\-[0-9]{2}\-[0-9]{2}$/}},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.errors;return[n("PhoneInput",{class:{"validate-error":r.length},attrs:{label:e.$t("login.phone_label")},on:{focus:e.hideErrorMessage},model:{value:e.newPhone,callback:function(t){e.newPhone=t},expression:"newPhone"}},[r.length?n("ValidationError",{attrs:{message:r[0]}}):e._e()],1),e._v(" "),n("ValidationProvider",{attrs:{vid:"changeWitchSecretWord_secretWord",name:e.$t("secret_word.answer_label"),rules:{required:!0,max:50}},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.errors;return[n("TextInput",{class:{"validate-error":r.length},attrs:{placeholder:e.$t("secret_word.answer_label"),label:e.$t("secret_word.answer_label")},on:{focus:e.hideErrorMessage},model:{value:e.secretWord,callback:function(t){e.secretWord=t},expression:"secretWord"}},[r.length?n("ValidationError",{attrs:{message:r[0]}}):e._e()],1),e._v(" "),n("span",{staticClass:"phone-change__secret-word-helper"},[e._v("\n              "+e._s(e.$t("phone_change.new_phone.secret_word.help"))+" "+e._s(e.secretWordHelper)+"\n            ")])]}}],null,!0)})]}}])})],1)],1),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.activeStageNumber===e.STAGES.changeWitchCard,expression:"activeStageNumber === STAGES.changeWitchCard"}]},[n("ValidationObserver",{ref:"change_witch_card"},[n("ValidationProvider",{attrs:{vid:"changeWitchCard",name:e.$t("validator.phone"),rules:{required:!0,regex:/^\+380\s\([0-9]{2}\)\s[0-9]{3}\-[0-9]{2}\-[0-9]{2}$/}},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.errors;return[n("PhoneInput",{class:{"validate-error":r.length},attrs:{label:e.$t("login.phone_label")},on:{focus:e.hideErrorMessage},model:{value:e.newPhone,callback:function(t){e.newPhone=t},expression:"newPhone"}},[r.length?n("ValidationError",{attrs:{message:r[0]}}):e._e()],1)]}}])})],1),e._v(" "),n("p",[e._v(e._s(e.$t("phone_change.new_phone.card.txt")))]),e._v(" "),n("div",{staticClass:"phone-change__card-list"},[n("b",[e._v(e._s(e.$t("phone_change.new_phone.card.previously_added_cards")))]),e._v(" "),e._l(e.cardList,(function(t,r){return n("span",{staticClass:"phone-change__card-list__item"},[e._v("\n          "+e._s(t.card_display_name)+"\n        ")])}))],2),e._v(" "),n("PaymentModal",{ref:"payment_modal",attrs:{"data-test":"card_verify-platon",paymentFields:e.paymentFormParams,actionUrl:e.paymentRequestUrl}})],1),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.isCantChangePhoneNumber,expression:"isCantChangePhoneNumber"}],staticClass:"phone-change__cant-change"},[n("img",{staticClass:"phone-change__cant-change__img",attrs:{src:"/img/icons/cant_change_phone.svg",alt:"cant change phone image"}}),e._v(" "),n("b",[e._v("\n        "+e._s(e.$t("phone_change.cant_change."+(e.isNeedFinishRegistration?"need_finish_registration":"wrong_card_number")+".title"))+"\n      ")]),e._v(" "),e.isNeedFinishRegistration?e._l(new Array(3),(function(t,r){return n("span",{staticClass:"phone-change__cant-change__txt"},[e._v("\n          "+e._s(e.$t("phone_change.cant_change.need_finish_registration.txt."+r))+"\n        ")])})):n("span",[e._v(e._s(e.$t("phone_change.cant_change.wrong_card_number.txt")))])],2),e._v(" "),e.isCantChangePhoneNumber?e._e():n("div",{directives:[{name:"show",rawName:"v-show",value:e.errorMessage,expression:"errorMessage"}],staticClass:"phone-change__error"},[e._v("\n      "+e._s(e.errorMessage)+"\n    ")]),e._v(" "),e.isNeedFinishRegistration?e._e():n("button",{staticClass:"dt-button-white phone-change__submit-btn",on:{click:function(t){return t.stopPropagation(),e.onSubmit(t)}}},[e._v("\n      "+e._s(e.submitBtnTxt)+"\n    ")])])],1)}),[],!1,null,null,null);t.default=component.exports}}]);
//# sourceMappingURL=058dd8d.js.map